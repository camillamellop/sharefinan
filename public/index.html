<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Share Brasil - Dashboard Gestor</title>
<!-- 
    SISTEMA DE GEST√ÉO SHARE BRASIL
    ================================
    Firebase Project: financeiro-share
    
    IMPORTANTE: Para o sistema funcionar corretamente:
    1. Configure as regras do Firestore para permitir leitura/escrita
    2. Verifique o console do navegador (F12) para logs de diagn√≥stico
    3. Se houver problemas, execute manualInit() no console
    -->
<!-- Teste de m√≥dulos ES6 -->
<script>
        // Limpar console para melhor visualiza√ß√£o
        console.clear();
        
        console.log('%c=== SHARE BRASIL - SISTEMA DE GEST√ÉO ===', 'color: #4A90E2; font-size: 16px; font-weight: bold;');
        console.log('%cVerificando ambiente...', 'color: #666;');
        console.log('Navegador:', navigator.userAgent);
        console.log('Testando suporte a m√≥dulos ES6...');
        
        // Verificar se o navegador suporta m√≥dulos ES6
        const supportsModules = 'noModule' in HTMLScriptElement.prototype;
        console.log('Suporte a m√≥dulos ES6:', supportsModules ? '‚úÖ SIM' : '‚ùå N√ÉO');
        
        if (!supportsModules) {
            alert('Seu navegador n√£o suporta m√≥dulos ES6. Por favor, atualize para uma vers√£o mais recente.');
        }
        
        // Teste b√°sico
        const testScript = document.createElement('script');
        testScript.type = 'module';
        testScript.textContent = `console.log('‚úÖ M√≥dulos ES6 suportados!');`;
        document.head.appendChild(testScript);
        
        // Teste de import
        const importTest = document.createElement('script');
        importTest.type = 'module';
        importTest.textContent = `
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            console.log('‚úÖ Import do Firebase funcionou!', initializeApp);
        `;
        document.head.appendChild(importTest);
    </script>
<!-- Firebase SDKs -->
<script type="module">// BYPASS DE EMERG√äNCIA - Remover em produ√ß√£o!
if (!localStorage.getItem('sharebrasilUser')) {
    console.log('Usu√°rio n√£o identificado - usando bypass de emerg√™ncia');
    localStorage.setItem('sharebrasilUser', 'Administrador');
    localStorage.setItem('sharebrasilUserId', 'admin');
    localStorage.setItem('sharebrasilUserRole', 'admin');
    localStorage.setItem('sharebrasilAuthenticated', 'true');
    localStorage.setItem('sharebrasilAuthMode', 'bypass');
}
        console.log('1. Iniciando carregamento do Firebase...');
        
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, where, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        console.log('2. Imports do Firebase realizados');
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCtRuVxTXn3Pb1FFSrJuwfe1HrgmvZwc9U",
            authDomain: "financeiro-share.firebaseapp.com",
            databaseURL: "https://financeiro-share-default-rtdb.firebaseio.com",
            projectId: "financeiro-share",
            storageBucket: "financeiro-share.firebasestorage.app",
            messagingSenderId: "317130008998",
            appId: "1:317130008998:web:35d31a426a7ff3b2184767",
            measurementId: "G-VZLH0YHBVS"
        };
        
        console.log('3. Configura√ß√£o do Firebase definida');
        
        // Initialize Firebase
        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            
            console.log('4. Firebase inicializado com sucesso:', app);
            console.log('5. Firestore conectado:', db);
            console.log('6. Auth configurado:', auth);
            
            // Verificar autentica√ß√£o
            onAuthStateChanged(auth, (user) => {
                if (user) {
            
                    // Verificar autentica√ß√£o - VERS√ÉO CORRIGIDA
const checkAuth = () => {
    // Primeiro verificar autentica√ß√£o local
    const isAuthenticated = localStorage.getItem('sharebrasilAuthenticated');
    const savedUser = localStorage.getItem('sharebrasilUser');
    
    if (isAuthenticated === 'true' && savedUser) {
        console.log('‚úÖ Usu√°rio autenticado localmente:', savedUser);
        
        // Atualizar interface
        const userNameElements = document.querySelectorAll('.user-name');
        userNameElements.forEach(el => {
            el.textContent = savedUser;
        });
        
        // IMPORTANTE: Esconder loading
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
        }
        
        console.log('Sistema pronto para uso!');
        return true;
    }
    return false;
};

// Verificar imediatamente
if (!checkAuth()) {
    // Se n√£o tem auth local, tentar Firebase (com timeout)
    let authTimeout = setTimeout(() => {
        console.log('Timeout na autentica√ß√£o - redirecionando...');
        window.location.href = 'index.html';
    }, 5000); // 5 segundos de timeout
    
    try {
        onAuthStateChanged(auth, (user) => {
            clearTimeout(authTimeout); // Limpar timeout
            
            if (user) {
                console.log('‚úÖ Usu√°rio autenticado via Firebase');
                // Esconder loading
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
            } else {
                console.log('‚ùå N√£o autenticado - redirecionando...');
                window.location.href = 'index.html';
            }
        });
    } catch (error) {
        clearTimeout(authTimeout);
        console.error('Erro no Firebase Auth:', error);
        window.location.href = 'index.html';
    }
}
                } else {
                    console.log('‚ùå Usu√°rio n√£o autenticado - redirecionando para login');
                    // Pequeno delay para evitar redirecionamento durante carregamento inicial
                    setTimeout(() => {
                        window.location.href = 'index.html'; // Mudado de login.html para index.html
                    }, 1000);
                }
            });
            
            // Make functions available globally
            window.db = db;
            window.auth = auth;
            window.firestore = {
                collection,
                addDoc,
                getDocs,
                updateDoc,
                deleteDoc,
                doc,
                onSnapshot,
                query,
                orderBy,
                where,
                getDoc
            };
            
            // Fun√ß√£o global de logout
            window.logout = async () => {
                if (confirm('Deseja realmente sair do sistema?')) {
                    try {
                        await signOut(auth);
                        localStorage.removeItem('sharebrasilUser');
                        localStorage.removeItem('sharebrasilUserId');
                        window.location.href = 'index.html'; // Mudado de login.html para index.html
                    } catch (error) {
                        console.error('Erro ao fazer logout:', error);
                        alert('Erro ao sair. Tente novamente.');
                    }
                }
            };
            
            console.log('7. Fun√ß√µes do Firebase disponibilizadas globalmente');
            
            // Disparar evento customizado quando Firebase estiver pronto
            window.dispatchEvent(new Event('firebaseReady'));
            console.log('8. Evento firebaseReady disparado');// For√ßar remo√ß√£o do loading ap√≥s 3 segundos
setTimeout(() => {
    const loadingOverlay = document.getElementById('loading-overlay');
    if (loadingOverlay && loadingOverlay.style.display !== 'none') {
        console.log('For√ßando remo√ß√£o do loading...');
        loadingOverlay.style.display = 'none';
    }
}, 3000);
            
        } catch (error) {
            console.error('ERRO ao inicializar Firebase:', error);
            alert('Erro ao inicializar o sistema: ' + error.message);
        }
    </script>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #F5F6FA;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #1E3A5F;
            color: white;
            padding: 1.5rem 0;
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .sidebar-menu {
            padding-top: 1rem;
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 1rem;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background: #2C5282;
            border-left: 4px solid #4A90E2;
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 2rem;
        }

        /* Header */
        .page-header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            color: #1E3A5F;
            font-weight: 600;
        }

        .page-subtitle {
            color: #6B7280;
            margin-top: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4A90E2;
            color: white;
        }

        .btn-primary:hover {
            background: #357ABD;
        }

        .btn-danger {
            background: #EF4444;
            color: white;
        }

        .btn-danger:hover {
            background: #DC2626;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .card-icon.green {
            background: #10B981;
            color: white;
        }

        .card-icon.red {
            background: #EF4444;
            color: white;
        }

        .card-icon.blue {
            background: #3B82F6;
            color: white;
        }

        .card-icon.purple {
            background: #8B5CF6;
            color: white;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1E3A5F;
            margin-bottom: 0.5rem;
        }

        .card-label {
            color: #6B7280;
            font-size: 0.9rem;
        }

        .card-change {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .card-change.positive {
            color: #10B981;
        }

        .card-change.negative {
            color: #EF4444;
        }

        /* Charts Section */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1E3A5F;
        }

        .chart-filters {
            display: flex;
            gap: 0.5rem;
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            background: white;
            color: #374151;
            font-size: 0.9rem;
        }

        /* Table */
        .table-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: #F3F4F6;
            border-radius: 8px;
            width: 300px;
        }

        .search-input {
            border: none;
            background: none;
            outline: none;
            flex: 1;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem;
            border-bottom: 2px solid #E5E7EB;
            color: #6B7280;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #F3F4F6;
        }

        tr:hover {
            background: #F9FAFB;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-badge.entrada {
            background: #D1FAE5;
            color: #065F46;
        }

        .status-badge.saida {
            background: #FEE2E2;
            color: #991B1B;
        }

        .status-badge.ativo {
            background: #D1FAE5;
            color: #065F46;
        }

        .status-badge.inativo {
            background: #F3F4F6;
            color: #6B7280;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1E3A5F;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #F3F4F6;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: #4A90E2;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
            font-size: 1rem;
            background: white;
        }

        /* Calendar */
        .calendar-container {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
        }

        .calendar-day:hover {
            background: #F3F4F6;
        }

        .calendar-day.has-expense {
            background: #FEE2E2;
            color: #991B1B;
            font-weight: 600;
        }

        /* Notes */
        .notes-container {
            background: #FEFCE8;
            padding: 1.5rem;
            border-radius: 10px;
            border: 2px solid #FDE047;
            margin-top: 1rem;
        }

        .notes-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #854D0E;
            font-weight: 600;
        }

        .notes-content {
            min-height: 100px;
            background: none;
            border: none;
            width: 100%;
            resize: vertical;
            font-family: inherit;
            color: #854D0E;
            outline: none;
        }

        /* Chart Placeholder */
        .chart-placeholder {
            height: 300px;
            background: #F3F4F6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6B7280;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: #6B7280;
        }

        /* Loading state */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
<div>
<div class="loading-spinner"></div>
<p style="margin-top: 1rem; color: #666;">Carregando sistema...</p>
<p style="margin-top: 0.5rem; color: #999; font-size: 0.9rem;">Conectando ao Firebase...</p>
</div>
</div>
<!-- Sidebar -->
<aside class="sidebar">
<div class="sidebar-header">
<h2>Share Brasil</h2>
</div>
<nav class="sidebar-menu">
<a class="menu-item active" href="#" onclick="showSection('dashboard')">
<span class="menu-icon">üìä</span>
                Dashboard
            </a>
<a class="menu-item" href="#" onclick="showSection('financeiro')">
<span class="menu-icon">üí∞</span>
                Financeiro
            </a>
<a class="menu-item" href="#" onclick="showSection('contatos')">
<span class="menu-icon">üë•</span>
                Contatos
            </a>
<a class="menu-item" href="#" onclick="showSection('funcionarios')">
<span class="menu-icon">üë®‚Äçüíº</span>
                Funcion√°rios
            </a>
<a class="menu-item" href="#" onclick="showSection('inadimplencia')">
<span class="menu-icon">‚ö†Ô∏è</span>
                Inadimpl√™ncia
            </a>
<a class="menu-item" href="#" onclick="showSection('notafiscal')">
<span class="menu-icon">üìÑ</span>
                Nota Fiscal
            </a>
<a class="menu-item" href="#" onclick="showSection('bloconotas')">
<span class="menu-icon">üìù</span>
                Bloco de Notas
            </a>
<a class="menu-item" href="#" onclick="showSection('relatorios')">
<span class="menu-icon">üìà</span>
                Relat√≥rios
            </a>
<a class="menu-item" href="#" onclick="showSection('backup')">
<span class="menu-icon">üíæ</span>
                Backup
            </a>
<a class="menu-item" href="#" onclick="showSection('configuracoes')">
<span class="menu-icon">‚öôÔ∏è</span>
                Configura√ß√µes
            </a>
<a class="menu-item" href="#" onclick="testFirebase()">
<span class="menu-icon">üîß</span>
                Debug Firebase
            </a>
</nav>
<!-- User Info Section -->
<div style="position: absolute; bottom: 0; left: 0; right: 0; padding: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
<div style="display: flex; align-items: center; justify-content: space-between; color: white;">
<div style="display: flex; align-items: center; gap: 0.5rem;">
<div style="width: 32px; height: 32px; background: rgba(255, 255, 255, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem;">
                        üë§
                    </div>
<span class="user-name" style="font-size: 0.9rem;">Usu√°rio</span>
</div>
<button onclick="logout()" style="background: none; border: none; color: white; cursor: pointer; padding: 0.5rem;" title="Sair">
                    üö™
                </button>
</div>
</div>
</aside>
<!-- Main Content -->
<main class="main-content">
<!-- Dashboard Section -->
<section class="content-section" id="dashboard-section">
<!-- Header -->
<div class="page-header">
<div>
<h1 class="page-title">Dashboard - Resumo Executivo</h1>
<p class="page-subtitle">Vis√£o geral r√°pida das finan√ßas do m√™s atual</p>
</div>
<div class="header-actions">
<select class="filter-select">
<option>Janeiro</option>
<option>Fevereiro</option>
<option>Mar√ßo</option>
</select>
<select class="filter-select">
<option>2025</option>
<option>2024</option>
</select>
<button class="btn btn-primary" onclick="openModal('lancamento')">
                        ‚ûï Novo Lan√ßamento
                    </button>
</div>
</div>
<!-- Dashboard Cards -->
<div class="dashboard-grid">
<div class="dashboard-card">
<div class="card-icon green">üìà</div>
<div class="card-change positive">+12.5%</div>
<div class="card-label">Total Entradas</div>
<div class="card-value" id="total-entradas">R$ 0,00</div>
<div style="font-size: 0.85rem; color: #6B7280; margin-top: 0.5rem;">
                        Baseado em contas recebidas
                    </div>
</div>
<div class="dashboard-card">
<div class="card-icon red">üìâ</div>
<div class="card-change negative">+8.3%</div>
<div class="card-label">Total Sa√≠das</div>
<div class="card-value" id="total-saidas">R$ 0,00</div>
<div style="font-size: 0.85rem; color: #6B7280; margin-top: 0.5rem;">
                        Baseado em contas pagas
                    </div>
</div>
<div class="dashboard-card">
<div class="card-icon blue">üí∞</div>
<div class="card-change positive">0%</div>
<div class="card-label">Resultado do M√™s</div>
<div class="card-value" id="resultado-mes">R$ 0,00</div>
<div style="font-size: 0.85rem; color: #6B7280; margin-top: 0.5rem;">
                        Entradas - Sa√≠das
                    </div>
</div>
<div class="dashboard-card">
<div class="card-icon purple">üí≥</div>
<div class="card-label">Pago na √öltima Semana</div>
<div class="card-value" id="pago-semana" style="color: #EF4444;">-R$ 0,00</div>
<div style="font-size: 0.85rem; color: #6B7280; margin-top: 0.5rem;">
                        Pagamentos √∫ltimos 7 dias
                    </div>
</div>
</div>
<!-- Charts -->
<div class="charts-container">
<div class="chart-card">
<div class="chart-header">
<h3 class="chart-title">An√°lise por Categoria</h3>
<div class="chart-filters">
<select class="filter-select">
<option>√öltimos 30 dias</option>
<option>√öltimos 60 dias</option>
<option>√öltimos 90 dias</option>
</select>
</div>
</div>
<div class="chart-placeholder">
<canvas id="categoriaChart"></canvas>
</div>
</div>
<div class="chart-card">
<div class="chart-header">
<h3 class="chart-title">DRE - Demonstra√ß√£o de Resultado</h3>
</div>
<div class="chart-placeholder">
<canvas id="dreChart"></canvas>
</div>
</div>
</div>
<!-- Recent Transactions -->
<div class="table-card">
<div class="table-header">
<h3 class="chart-title">√öltimas Transa√ß√µes</h3>
<div class="search-box">
<span>üîç</span>
<input class="search-input" id="search-transacoes" placeholder="Pesquisar..." type="text"/>
</div>
</div>
<table>
<thead>
<tr>
<th>Data</th>
<th>Descri√ß√£o</th>
<th>Categoria</th>
<th>Tipo</th>
<th>Valor</th>
<th>Status</th>
</tr>
</thead>
<tbody id="transacoes-tbody">
<tr>
<td class="loading" colspan="6">Carregando transa√ß√µes...</td>
</tr>
</tbody>
</table>
</div>
</section>
<!-- Funcion√°rios Section -->
<section class="content-section" id="funcionarios-section" style="display: none;">
<div class="page-header">
<div>
<h1 class="page-title">Gest√£o de Funcion√°rios</h1>
<p class="page-subtitle">Cadastro e controle de funcion√°rios</p>
</div>
<div class="header-actions">
<button class="btn btn-primary" onclick="openModal('funcionario')">
                        ‚ûï Novo Funcion√°rio
                    </button>
</div>
</div>
<!-- Stats Cards -->
<div class="dashboard-grid">
<div class="dashboard-card">
<div class="card-icon green">üë•</div>
<div class="card-label">Total de Funcion√°rios</div>
<div class="card-value" id="total-funcionarios">0</div>
</div>
<div class="dashboard-card">
<div class="card-icon blue">‚úÖ</div>
<div class="card-label">Ativos</div>
<div class="card-value" id="funcionarios-ativos">0</div>
</div>
<div class="dashboard-card">
<div class="card-icon red">‚ùå</div>
<div class="card-label">Inativos</div>
<div class="card-value" id="funcionarios-inativos">0</div>
</div>
<div class="dashboard-card">
<div class="card-icon purple">üí∞</div>
<div class="card-label">Folha de Pagamento</div>
<div class="card-value" id="folha-pagamento">R$ 0,00</div>
</div>
</div>
<!-- Funcion√°rios Table -->
<div class="table-card">
<div class="table-header">
<h3 class="chart-title">Lista de Funcion√°rios</h3>
<div class="search-box">
<span>üîç</span>
<input class="search-input" id="search-funcionarios" placeholder="Pesquisar funcion√°rios..." type="text"/>
</div>
</div>
<table>
<thead>
<tr>
<th>Nome</th>
<th>CPF</th>
<th>Cargo</th>
<th>Departamento</th>
<th>Admiss√£o</th>
<th>Sal√°rio</th>
<th>Status</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="funcionarios-tbody">
<tr>
<td class="loading" colspan="8">Carregando funcion√°rios...</td>
</tr>
</tbody>
</table>
</div>
</section>
<!-- Financeiro Section -->
<section class="content-section" id="financeiro-section" style="display: none;">
<div class="page-header">
<div>
<h1 class="page-title">Gest√£o Financeira</h1>
<p class="page-subtitle">Controle de entradas e sa√≠das</p>
</div>
<div class="header-actions">
<button class="btn btn-primary" onclick="openModal('receita')">
                        ‚ûï Nova Receita
                    </button>
<button class="btn btn-primary" onclick="openModal('despesa')">
                        ‚ûñ Nova Despesa
                    </button>
</div>
</div>
<!-- Calendar View -->
<div class="calendar-container">
<div class="calendar-header">
<h3 class="chart-title">Calend√°rio de Despesas - Janeiro 2025</h3>
<div class="chart-filters">
<button class="btn">‚¨ÖÔ∏è</button>
<button class="btn">‚û°Ô∏è</button>
</div>
</div>
<div class="calendar-grid">
<!-- Week days -->
<div style="text-align: center; font-weight: 600; color: #6B7280;">Dom</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">Seg</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">Ter</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">Qua</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">Qui</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">Sex</div>
<div style="text-align: center; font-weight: 600; color: #6B7280;">S√°b</div>
<!-- Calendar days will be generated here -->
</div>
</div>
</section>
<!-- Contatos Section -->
<section class="content-section" id="contatos-section" style="display: none;">
<div class="page-header">
<div>
<h1 class="page-title">Contatos</h1>
<p class="page-subtitle">Gerencie clientes, fornecedores e funcion√°rios</p>
</div>
<div class="header-actions">
<button class="btn btn-primary" onclick="openModal('contato')">
                        ‚ûï Novo Contato
                    </button>
<button class="btn" onclick="popularClientes()" title="Popular clientes iniciais">
                        üì• Importar Clientes
                    </button>
</div>
</div>
<!-- Contact Filters -->
<div class="dashboard-grid" style="margin-bottom: 2rem;">
<button class="dashboard-card" style="cursor: pointer;">
<div class="card-icon blue">üë•</div>
<div class="card-label">Todos</div>
<div class="card-value" id="total-contatos">0</div>
</button>
<button class="dashboard-card" style="cursor: pointer;">
<div class="card-icon green">üë§</div>
<div class="card-label">Clientes</div>
<div class="card-value" id="total-clientes">0</div>
</button>
<button class="dashboard-card" style="cursor: pointer;">
<div class="card-icon purple">üè¢</div>
<div class="card-label">Fornecedores</div>
<div class="card-value" id="total-fornecedores">0</div>
</button>
</div>
<!-- Contacts Table -->
<div class="table-card">
<div class="table-header">
<h3 class="chart-title">Lista de Contatos</h3>
<div class="search-box">
<span>üîç</span>
<input class="search-input" placeholder="Pesquisar contatos..." type="text"/>
</div>
</div>
<table>
<thead>
<tr>
<th>Nome</th>
<th>Tipo</th>
<th>CNPJ/CPF</th>
<th>Telefone</th>
<th>Email</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="contatos-tbody">
<tr>
<td class="loading" colspan="6">Carregando contatos...</td>
</tr>
</tbody>
</table>
</div>
</section>
<!-- Nota Fiscal Section -->
<section class="content-section" id="notafiscal-section" style="display: none;">
<div class="page-header">
<div>
<h1 class="page-title">Notas Fiscais</h1>
<p class="page-subtitle">Gerencie e organize suas notas fiscais</p>
</div>
<div class="header-actions">
<button class="btn btn-primary" onclick="openModal('notafiscal')">
                        üìé Anexar Nota Fiscal
                    </button>
</div>
</div>
<!-- Monthly Folders -->
<div class="dashboard-grid">
<div class="dashboard-card" style="cursor: pointer;">
<div class="card-icon blue">üìÅ</div>
<div class="card-label">Janeiro 2025</div>
<div class="card-value">12</div>
<div style="font-size: 0.85rem; color: #6B7280;">notas fiscais</div>
</div>
<div class="dashboard-card" style="cursor: pointer;">
<div class="card-icon blue">üìÅ</div>
<div class="card-label">Dezembro 2024</div>
<div class="card-value">28</div>
<div style="font-size: 0.85rem; color: #6B7280;">notas fiscais</div>
</div>
<div class="dashboard-card" style="cursor: pointer;">
<div class="card-icon blue">üìÅ</div>
<div class="card-label">Novembro 2024</div>
<div class="card-value">25</div>
<div style="font-size: 0.85rem; color: #6B7280;">notas fiscais</div>
</div>
</div>
<!-- Recent Notes -->
<div class="table-card">
<div class="table-header">
<h3 class="chart-title">Notas Fiscais Recentes</h3>
<div class="search-box">
<span>üîç</span>
<input class="search-input" placeholder="Pesquisar notas..." type="text"/>
</div>
</div>
<table>
<thead>
<tr>
<th>Data</th>
<th>N√∫mero</th>
<th>Cliente/Fornecedor</th>
<th>Valor</th>
<th>Tipo</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody>
<tr>
<td>25/01/2025</td>
<td>NF-2025-001</td>
<td>WATT - DISTRIBUIDORA</td>
<td>R$ 5.432,10</td>
<td><span class="status-badge entrada">Entrada</span></td>
<td>
<button class="btn" style="padding: 0.5rem;">üìÑ</button>
<button class="btn" style="padding: 0.5rem;">‚¨áÔ∏è</button>
</td>
</tr>
</tbody>
</table>
</div>
</section>
<!-- Bloco de Notas Section -->
<section class="content-section" id="bloconotas-section" style="display: none;">
<div class="page-header">
<div>
<h1 class="page-title">Bloco de Notas</h1>
<p class="page-subtitle">Anota√ß√µes r√°pidas e lembretes</p>
</div>
</div>
<div class="notes-container">
<div class="notes-header">
<span>üìù</span>
<span>Notas R√°pidas</span>
</div>
<textarea class="notes-content" placeholder="Digite suas anota√ß√µes aqui...">- Reuni√£o com contador √†s 15h
- Verificar relat√≥rio PR-MDL
- Enviar documentos DECEA at√© sexta
- Pagar fornecedor XYZ at√© dia 30</textarea>
</div>
<div class="dashboard-grid" style="margin-top: 2rem;">
<div class="dashboard-card">
<div class="card-icon purple">üìå</div>
<div class="card-label">Tarefas Pendentes</div>
<ul style="margin-top: 1rem; padding-left: 1.5rem; color: #6B7280;">
<li>Emitir NF para cliente ABC</li>
<li>Conferir extrato banc√°rio</li>
<li>Atualizar planilha de custos</li>
</ul>
</div>
<div class="dashboard-card">
<div class="card-icon green">‚úÖ</div>
<div class="card-label">Conclu√≠das Hoje</div>
<ul style="margin-top: 1rem; padding-left: 1.5rem; color: #6B7280;">
<li style="text-decoration: line-through;">Pagar conta de luz</li>
<li style="text-decoration: line-through;">Enviar relat√≥rio mensal</li>
</ul>
</div>
</div>
</section>
</main>
<!-- Modals -->
<!-- Funcion√°rio Modal -->
<div class="modal" id="funcionario-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="funcionario-modal-title">Novo Funcion√°rio</h2>
<button class="close-btn" onclick="closeModal('funcionario')">‚úï</button>
</div>
<form id="funcionario-form">
<input id="funcionario-id" type="hidden"/>
<div class="form-group">
<label class="form-label">Nome Completo *</label>
<input class="form-input" id="funcionario-nome" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">CPF *</label>
<input class="form-input" id="funcionario-cpf" placeholder="000.000.000-00" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Email</label>
<input class="form-input" id="funcionario-email" type="email"/>
</div>
<div class="form-group">
<label class="form-label">Telefone</label>
<input class="form-input" id="funcionario-telefone" placeholder="(00) 00000-0000" type="tel"/>
</div>
<div class="form-group">
<label class="form-label">Cargo *</label>
<input class="form-input" id="funcionario-cargo" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Departamento</label>
<select class="form-select" id="funcionario-departamento">
<option value="">Selecione</option>
<option value="Administrativo">Administrativo</option>
<option value="Operacional">Operacional</option>
<option value="Financeiro">Financeiro</option>
<option value="RH">RH</option>
<option value="TI">TI</option>
<option value="Comercial">Comercial</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Data de Admiss√£o *</label>
<input class="form-input" id="funcionario-admissao" required="" type="date"/>
</div>
<div class="form-group">
<label class="form-label">Sal√°rio</label>
<input class="form-input" id="funcionario-salario" placeholder="R$ 0,00" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Status</label>
<select class="form-select" id="funcionario-status">
<option value="ativo">Ativo</option>
<option value="inativo">Inativo</option>
<option value="ferias">F√©rias</option>
<option value="afastado">Afastado</option>
</select>
</div>
<div style="display: flex; gap: 1rem; justify-content: flex-end;">
<button class="btn" onclick="closeModal('funcionario')" type="button">Cancelar</button>
<button class="btn btn-primary" type="submit">Salvar</button>
</div>
<div>
<label class="block mb-1">
<input class="mr-2" id="reembolsavel" type="checkbox"/>
            Essa despesa precisa ser reembolsada?
        </label>
</div>
</form>
</div>
</div>
<!-- Lan√ßamento Modal -->
<div class="modal" id="lancamento-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title">Novo Lan√ßamento</h2>
<button class="close-btn" onclick="closeModal('lancamento')">‚úï</button>
</div>
<form id="lancamento-form">
<div class="form-group">
<label class="form-label">Tipo</label>
<select class="form-select" id="lancamento-tipo">
<option value="receita">Receita</option>
<option value="despesa">Despesa</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Descri√ß√£o</label>
<input class="form-input" id="lancamento-descricao" placeholder="Descri√ß√£o do lan√ßamento" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Categoria</label>
<select class="form-select" id="lancamento-categoria">
<option>Selecione uma categoria</option>
<option>Despesas Share</option>
<option>Ressarcim. Pago</option>
<option>Contratos</option>
<option>Outros</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Valor</label>
<input class="form-input" id="lancamento-valor" placeholder="R$ 0,00" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Data de Vencimento</label>
<input class="form-input" id="lancamento-data" required="" type="date"/>
</div>
<div style="display: flex; gap: 1rem; justify-content: flex-end;">
<button class="btn" onclick="closeModal('lancamento')" type="button">Cancelar</button>
<button class="btn btn-primary" type="submit">Salvar</button>
</div>
</form>
</div>
</div>
<!-- Contato Modal -->
<div class="modal" id="contato-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title">Novo Contato</h2>
<button class="close-btn" onclick="closeModal('contato')">‚úï</button>
</div>
<form id="contato-form">
<div class="form-group">
<label class="form-label">Tipo de Contato</label>
<select class="form-select" id="contato-tipo">
<option value="cliente">Cliente</option>
<option value="fornecedor">Fornecedor</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Nome/Raz√£o Social</label>
<input class="form-input" id="contato-nome" placeholder="Nome completo ou raz√£o social" required="" type="text"/>
</div>
<div class="form-group">
<label class="form-label">CNPJ/CPF</label>
<input class="form-input" id="contato-documento" placeholder="00.000.000/0000-00" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Email</label>
<input class="form-input" id="contato-email" placeholder="email@exemplo.com" type="email"/>
</div>
<div class="form-group">
<label class="form-label">Telefone</label>
<input class="form-input" id="contato-telefone" placeholder="(00) 00000-0000" type="tel"/>
</div>
<div style="display: flex; gap: 1rem; justify-content: flex-end;">
<button class="btn" onclick="closeModal('contato')" type="button">Cancelar</button>
<button class="btn btn-primary" type="submit">Salvar</button>
</div>
</form>
</div>
</div>
<!-- Nota Fiscal Modal -->
<div class="modal" id="notafiscal-modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title">Anexar Nota Fiscal</h2>
<button class="close-btn" onclick="closeModal('notafiscal')">‚úï</button>
</div>
<form>
<div class="form-group">
<label class="form-label">N√∫mero da Nota</label>
<input class="form-input" placeholder="NF-0000" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Cliente/Fornecedor</label>
<select class="form-select">
<option>Selecione</option>
<option>WATT - DISTRIBUIDORA</option>
<option>GA SERVICE</option>
</select>
</div>
<div class="form-group">
<label class="form-label">Data de Emiss√£o</label>
<input class="form-input" type="date"/>
</div>
<div class="form-group">
<label class="form-label">Valor</label>
<input class="form-input" placeholder="R$ 0,00" type="text"/>
</div>
<div class="form-group">
<label class="form-label">Arquivo</label>
<input accept=".pdf,.xml" class="form-input" type="file"/>
</div>
<div style="display: flex; gap: 1rem; justify-content: flex-end;">
<button class="btn" onclick="closeModal('notafiscal')" type="button">Cancelar</button>
<button class="btn btn-primary" type="submit">Anexar</button>
</div>
</form>
</div>
</div>
<script type="module">
        console.log('=== INICIANDO SISTEMA SHARE BRASIL ===');
        
        // Capturar erros globais
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Erro global capturado:', msg, error);
            
            // Verificar se √© erro de permiss√£o do Firebase
            if (msg.includes('permission-denied') || (error && error.code === 'permission-denied')) {
                console.error('‚ùå Erro de permiss√£o detectado');
                if (confirm('Sess√£o expirada ou sem permiss√£o. Deseja fazer login novamente?')) {
                    window.location.href = 'index.html'; // Mudado de login.html para index.html
                }
            }
            
            return false;
        };
        
        // Listener para quando Firebase estiver pronto
        window.addEventListener('firebaseReady', function() {
            console.log('üéâ Evento firebaseReady recebido!');
            // For√ßar inicializa√ß√£o se ainda n√£o tiver iniciado
            if (!window.initialized) {
                initializeApp();
            }
        });
        
        // Loading control
        function hideLoading() {// Loading control
function hideLoading() {
    console.log('Escondendo loading...');
    const loading = document.getElementById('loading-overlay');
    if (loading) {
        loading.style.display = 'none';
    }
    // Garantir que seja removido
    setTimeout(() => {
        const loadingCheck = document.getElementById('loading-overlay');
        if (loadingCheck) {
            loadingCheck.remove();
        }
    }, 100);
}

function showLoading() {
    const loading = document.getElementById('loading-overlay');
    if (loading) {
        loading.style.display = 'flex';
    }
}

// Auto-hide loading ap√≥s 5 segundos (failsafe)
setTimeout(() => {
    hideLoading();
    console.log('Loading removido por timeout');
}, 5000);
            const loading = document.getElementById('loading-overlay');
            if (loading) {
                loading.style.display = 'none';
            }
        }

        function showLoading() {
            const loading = document.getElementById('loading-overlay');
            if (loading) {
                loading.style.display = 'flex';
            }
        }

        // Initialize Firebase and app
        let initAttempts = 0;
        const maxAttempts = 10;
        window.initialized = false;

        function initializeApp() {
            // Verificar se o DOM est√° pronto
            if (!document.getElementById('loading-overlay')) {
                console.error('DOM n√£o est√° pronto ainda');
                setTimeout(initializeApp, 500);
                return;
            }
            
            if (window.initialized) {
                console.log('Sistema j√° inicializado, ignorando...');
                return;
            }
            
            initAttempts++;
            console.log(`Tentativa ${initAttempts} de inicializa√ß√£o...`);
            
            // Verificar se Firebase est√° carregado
            if (!window.firestore || !window.db) {
                console.log('Firebase ainda n√£o est√° dispon√≠vel...');
                
                if (initAttempts < maxAttempts) {
                    setTimeout(initializeApp, 1000);
                } else {
                    console.error('Firebase n√£o p√¥de ser carregado ap√≥s m√∫ltiplas tentativas');
                    hideLoading();
                    document.body.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column;">
                            <h2 style="color: #EF4444; margin-bottom: 1rem;">Erro ao conectar com o banco de dados</h2>
                            <p style="color: #666; margin-bottom: 2rem;">Verifique sua conex√£o com a internet e recarregue a p√°gina.</p>
                            <button onclick="location.reload()" style="padding: 0.75rem 1.5rem; background: #4A90E2; color: white; border: none; border-radius: 8px; cursor: pointer;">
                                Recarregar P√°gina
                            </button>
                        </div>
                    `;
                }
                return;
            }

            console.log('Firebase carregado com sucesso!');
            
            try {
                const { collection, addDoc, getDocs, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy, where, getDoc } = window.firestore;
                const db = window.db;

                console.log('Firestore functions importadas com sucesso');

                // Database Operations
                class DatabaseManager {
                    // Funcion√°rios
                    async addFuncionario(data) {
                        try {
                            const docRef = await addDoc(collection(db, "funcionarios"), {
                                ...data,
                                createdAt: new Date()
                            });
                            console.log("Funcion√°rio adicionado com ID: ", docRef.id);
                            return docRef.id;
                        } catch (error) {
                            console.error("Erro ao adicionar funcion√°rio: ", error);
                            alert("Erro ao adicionar funcion√°rio!");
                        }
                    }

                    async updateFuncionario(id, data) {
                        try {
                            const funcionarioRef = doc(db, "funcionarios", id);
                            await updateDoc(funcionarioRef, {
                                ...data,
                                updatedAt: new Date()
                            });
                            console.log("Funcion√°rio atualizado");
                        } catch (error) {
                            console.error("Erro ao atualizar funcion√°rio: ", error);
                            alert("Erro ao atualizar funcion√°rio!");
                        }
                    }

                    async deleteFuncionario(id) {
                        try {
                            await deleteDoc(doc(db, "funcionarios", id));
                            console.log("Funcion√°rio removido");
                        } catch (error) {
                            console.error("Erro ao remover funcion√°rio: ", error);
                            alert("Erro ao remover funcion√°rio!");
                        }
                    }

                    // Transa√ß√µes
                    async addTransacao(data) {
                        try {
                            const docRef = await addDoc(collection(db, "transacoes"), {
                                ...data,
                                createdAt: new Date()
                            });
                            console.log("Transa√ß√£o adicionada com ID: ", docRef.id);
                            return docRef.id;
                        } catch (error) {
                            console.error("Erro ao adicionar transa√ß√£o: ", error);
                            alert("Erro ao adicionar transa√ß√£o!");
                        }
                    }

                    // Contatos
                    async addContato(data) {
                        try {
                            const docRef = await addDoc(collection(db, "contatos"), {
                                ...data,
                                createdAt: new Date()
                            });
                            console.log("Contato adicionado com ID: ", docRef.id);
                            return docRef.id;
                        } catch (error) {
                            console.error("Erro ao adicionar contato: ", error);
                            alert("Erro ao adicionar contato!");
                        }
                    }
                }

                const dbManager = new DatabaseManager();
                window.dbManager = dbManager;

                // Real-time listeners
                function setupRealtimeListeners() {
                    // Funcion√°rios listener
                    const funcionariosQuery = query(collection(db, "funcionarios"), orderBy("nome"));
                    onSnapshot(funcionariosQuery, (snapshot) => {
                        const funcionarios = [];
                        let totalSalario = 0;
                        let ativos = 0;
                        let inativos = 0;

                        snapshot.forEach((doc) => {
                            const data = { id: doc.id, ...doc.data() };
                            funcionarios.push(data);
                            
                            if (data.status === 'ativo') {
                                ativos++;
                                totalSalario += parseFloat(data.salario || 0);
                            } else {
                                inativos++;
                            }
                        });

                        // Update stats
                        document.getElementById('total-funcionarios').textContent = funcionarios.length;
                        document.getElementById('funcionarios-ativos').textContent = ativos;
                        document.getElementById('funcionarios-inativos').textContent = inativos;
                        document.getElementById('folha-pagamento').textContent = formatCurrency(totalSalario);

                        // Update table
                        updateFuncionariosTable(funcionarios);
                    });

                    // Transa√ß√µes listener
                    const transacoesQuery = query(collection(db, "transacoes"), orderBy("data", "desc"));
                    onSnapshot(transacoesQuery, (snapshot) => {
                        const transacoes = [];
                        let totalEntradas = 0;
                        let totalSaidas = 0;

                        snapshot.forEach((doc) => {
                            const data = { id: doc.id, ...doc.data() };
                            transacoes.push(data);
                            
                            if (data.tipo === 'receita') {
                                totalEntradas += parseFloat(data.valor || 0);
                            } else {
                                totalSaidas += parseFloat(data.valor || 0);
                            }
                        });

                        // Update dashboard
                        document.getElementById('total-entradas').textContent = formatCurrency(totalEntradas);
                        document.getElementById('total-saidas').textContent = formatCurrency(totalSaidas);
                        document.getElementById('resultado-mes').textContent = formatCurrency(totalEntradas - totalSaidas);

                        // Update table
                        updateTransacoesTable(transacoes);
                    });

                    // Contatos listener
                    const contatosQuery = query(collection(db, "contatos"), orderBy("nome"));
                    onSnapshot(contatosQuery, (snapshot) => {
                        const contatos = [];
                        let clientes = 0;
                        let fornecedores = 0;

                        snapshot.forEach((doc) => {
                            const data = { id: doc.id, ...doc.data() };
                            contatos.push(data);
                            
                            if (data.tipo === 'cliente') {
                                clientes++;
                            } else {
                                fornecedores++;
                            }
                        });

                        // Update stats
                        document.getElementById('total-contatos').textContent = contatos.length;
                        document.getElementById('total-clientes').textContent = clientes;
                        document.getElementById('total-fornecedores').textContent = fornecedores;

                        // Update table
                        updateContatosTable(contatos);
                    });
                }

                // Update Tables Functions
                function updateFuncionariosTable(funcionarios) {
                    const tbody = document.getElementById('funcionarios-tbody');
                    
                    if (funcionarios.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Nenhum funcion√°rio cadastrado</td></tr>';
                        return;
                    }

                    tbody.innerHTML = funcionarios.map(f => `
                        <tr>
                            <td>${f.nome || ''}</td>
                            <td>${f.cpf || ''}</td>
                            <td>${f.cargo || ''}</td>
                            <td>${f.departamento || ''}</td>
                            <td>${f.admissao ? new Date(f.admissao).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${formatCurrency(f.salario || 0)}</td>
                            <td><span class="status-badge ${f.status}">${f.status || 'ativo'}</span></td>
                            <td class="action-buttons">
                                <button class="btn btn-small" onclick="editFuncionario('${f.id}')">‚úèÔ∏è</button>
                                <button class="btn btn-small btn-danger" onclick="deleteFuncionario('${f.id}')">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('');
                }

                function updateTransacoesTable(transacoes) {
                    const tbody = document.getElementById('transacoes-tbody');
                    
                    if (transacoes.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhuma transa√ß√£o registrada</td></tr>';
                        return;
                    }

                    tbody.innerHTML = transacoes.slice(0, 10).map(t => `
                        <tr>
                            <td>${t.data ? new Date(t.data).toLocaleDateString('pt-BR') : ''}</td>
                            <td>${t.descricao || ''}</td>
                            <td>${t.categoria || ''}</td>
                            <td><span class="status-badge ${t.tipo === 'receita' ? 'entrada' : 'saida'}">${t.tipo === 'receita' ? 'Entrada' : 'Sa√≠da'}</span></td>
                            <td>${formatCurrency(t.valor || 0)}</td>
                            <td>${t.status === 'pago' ? '‚úÖ Pago' : '‚è≥ Pendente'}</td>
                        </tr>
                    `).join('');
                }

                function updateContatosTable(contatos) {
                    const tbody = document.getElementById('contatos-tbody');
                    
                    if (contatos.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum contato cadastrado</td></tr>';
                        return;
                    }

                    tbody.innerHTML = contatos.map(c => `
                        <tr>
                            <td>${c.nome || ''}</td>
                            <td><span class="status-badge ${c.tipo === 'cliente' ? 'entrada' : 'saida'}">${c.tipo === 'cliente' ? 'Cliente' : 'Fornecedor'}</span></td>
                            <td>${c.documento || ''}</td>
                            <td>${c.telefone || ''}</td>
                            <td>${c.email || ''}</td>
                            <td class="action-buttons">
                                <button class="btn btn-small">‚úèÔ∏è</button>
                                <button class="btn btn-small btn-danger">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('');
                }

                // Initialize listeners
                setupRealtimeListeners();

                // Dados iniciais dos clientes
                const clientesIniciais = [
                    {
                        tipo: 'cliente',
                        nome: 'AGRITEX COMERCIAL AGRICOLA LTDA',
                        documento: '06.098.802/0001-62',
                        email: 'financeiro.pagar@agritex.com.br',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'AGRICULTURA E PECUARIA CAMPONOVENSE LTDA',
                        documento: '39.429.668/0001-94',
                        email: 'financeiro@agrocam.com.br',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'ARGO INTELIGENCIA DIGITAL LTDA',
                        documento: '39.752.281/0001-74',
                        email: 'FINANCEIRO@ARGOINTELIGENCIA.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'CARISMA INVESTIMENTOS E PARTICIPACOES S/A',
                        documento: '07.701.775/0001-33',
                        email: 'CARISMAPVA@GMAIL.COM',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'CARVALIMA TRANSPORTES LTDA',
                        documento: '35.070.814/0001-51',
                        email: 'VALDECIR@CARVALIMA.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'COMPLEXO TURISTICO SANTA ROSA PANTANAL HOTEIS LTDA',
                        documento: '03.785.623/0001-05',
                        email: 'FINANCEIRO@SANTAROSAPANTANAL.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'DUILIO NAVES JUNQUEIRA JUNIOR',
                        documento: '343.588.541-68',
                        email: 'duilio@odomprimeculaba.com.br',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'E. R. DE FIGUEIREDO & CIA LTDA',
                        documento: '30.541.222/0001-82',
                        email: 'elsonramos@live.com',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'ESTANCIA BAHIA EVENTOS LTDA',
                        documento: '26.373.673/0001-80',
                        email: 'CONTABILIDADE@ESTANCIABAHIA.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'EUGENIO ROBERTO BERGAMIM',
                        documento: '041.476.781-06',
                        email: '',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'GA SERVICE - GESTAO ADMINISTRATIVA LTDA',
                        documento: '10.942.203/0001-50',
                        email: 'NOTIFICACOES@GRUPOALDO.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'GRF INCORPORADORA E CONSTRUTORA LTDA',
                        documento: '32.187.187/0001-70',
                        email: 'FISCAL@EXATUSONLINE.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'NOGUEIRA PARTICIPACOES E EMPREENDIMENTOS LTDA',
                        documento: '12.645.475/0001-14',
                        email: 'ADRIANO@NOGUEIRACONTABIL.COM',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'NOVA ALIANCA AGRO LTDA',
                        documento: '28.080.165/0001-30',
                        email: 'EDSON@NOVAALIANCAAGRO.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'R.O.G HOLDING LTDA',
                        documento: '40.988.927/0001-04',
                        email: 'RAPHAELCOALASOCIAL@GMAIL.COM',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'RICARDO GOMES DOS SANTOS',
                        documento: '784.754.651-53',
                        email: 'ricardo@tunnaseguros.com.br',
                        telefone: '65992517629'
                    },
                    {
                        tipo: 'cliente',
                        nome: 'SOLUCAO TECNICA COMERCIO E SERVICOS DE EQUIPAMENTOS ELETRONICOS LTDA',
                        documento: '04.164.120/0001-85',
                        email: 'ADMINISTRATIVO@SOLUCAOTECNICA.COM.BR',
                        telefone: ''
                    },
                    {
                        tipo: 'cliente',
                        nome: 'WATT - DISTRIBUIDORA BRASIL. DE COMBUSTIVEIS E DERIVADOS DE PETROLEO LTDA',
                        documento: '03.908.643/0001-26',
                        email: 'GERENTECOMERCIAL@WATTBRAS.COM.BR',
                        telefone: ''
                    }
                ];

                // Fun√ß√£o para popular clientes iniciais (executar apenas uma vez)
                async function popularClientesIniciais() {
                    try {
                        // Teste de conex√£o
                        console.log('Testando conex√£o com Firestore...');
                        
                        // Verificar se j√° existem clientes
                        const clientesSnapshot = await getDocs(collection(db, "contatos"));
                        
                        console.log('Conex√£o com Firestore OK. Clientes existentes:', clientesSnapshot.size);
                        
                        if (clientesSnapshot.empty) {
                            console.log('Populando clientes iniciais...');
                            
                            for (const cliente of clientesIniciais) {
                                await addDoc(collection(db, "contatos"), {
                                    ...cliente,
                                    createdAt: new Date()
                                });
                            }
                            
                            console.log('Clientes iniciais adicionados com sucesso!');
                        }
                    } catch (error) {
                        console.error('Erro ao conectar com Firestore:', error);
                        
                        if (error.code === 'permission-denied') {
                            console.error('‚ùå ERRO DE PERMISS√ÉO NO FIRESTORE');
                            console.log('Poss√≠veis solu√ß√µes:');
                            console.log('1. Fa√ßa login primeiro em login.html');
                            console.log('2. Ou atualize as regras do Firestore');
                            console.log('Acesse: https://console.firebase.google.com/project/financeiro-share/firestore/rules');
                            
                            if (confirm('Erro de permiss√£o no banco de dados. Deseja ir para a tela de login?')) {
                                window.location.href = 'index.html'; // Mudado de login.html para index.html
                            }
                        } else {
                            alert('Erro ao conectar com o banco de dados: ' + error.message);
                        }
                    }
                }

                // Popular clientes iniciais se necess√°rio
                // Comentado para evitar inser√ß√£o autom√°tica
                // popularClientesIniciais();

                // Global functions for buttons
                window.editFuncionario = async (id) => {
                    const funcionarioRef = doc(db, "funcionarios", id);
                    const funcionarioSnap = await getDoc(funcionarioRef);
                    
                    if (funcionarioSnap.exists()) {
                        const data = funcionarioSnap.data();
                        
                        // Fill form
                        document.getElementById('funcionario-id').value = id;
                        document.getElementById('funcionario-nome').value = data.nome || '';
                        document.getElementById('funcionario-cpf').value = data.cpf || '';
                        document.getElementById('funcionario-email').value = data.email || '';
                        document.getElementById('funcionario-telefone').value = data.telefone || '';
                        document.getElementById('funcionario-cargo').value = data.cargo || '';
                        document.getElementById('funcionario-departamento').value = data.departamento || '';
                        document.getElementById('funcionario-admissao').value = data.admissao || '';
                        document.getElementById('funcionario-salario').value = formatCurrency(data.salario || 0);
                        document.getElementById('funcionario-status').value = data.status || 'ativo';
                        
                        document.getElementById('funcionario-modal-title').textContent = 'Editar Funcion√°rio';
                        openModal('funcionario');
                    }
                };

                window.deleteFuncionario = async (id) => {
                    if (confirm('Tem certeza que deseja remover este funcion√°rio?')) {
                        await dbManager.deleteFuncionario(id);
                    }
                };

                // Fun√ß√£o para popular clientes manualmente
                window.popularClientes = async () => {
                    if (confirm('Deseja importar os 18 clientes iniciais? Isso n√£o duplicar√° clientes existentes.')) {
                        showLoading();
                        try {
                            for (const cliente of clientesIniciais) {
                                // Verificar se cliente j√° existe pelo CNPJ
                                const q = query(collection(db, "contatos"), where("documento", "==", cliente.documento));
                                const querySnapshot = await getDocs(q);
                                
                                if (querySnapshot.empty) {
                                    await addDoc(collection(db, "contatos"), {
                                        ...cliente,
                                        createdAt: new Date()
                                    });
                                    console.log(`Cliente ${cliente.nome} adicionado`);
                                } else {
                                    console.log(`Cliente ${cliente.nome} j√° existe`);
                                }
                            }
                            alert('Importa√ß√£o conclu√≠da!');
                        } catch (error) {
                            console.error('Erro na importa√ß√£o:', error);
                            alert('Erro ao importar clientes');
                        } finally {
                            hideLoading();
                        }
                    }
                };

                // Fun√ß√£o de debug do Firebase
                window.testFirebase = async () => {
                    console.log('=== TESTE DE CONEX√ÉO FIREBASE ===');
                    console.log('window.db:', window.db);
                    console.log('window.firestore:', window.firestore);
                    
                    try {
                        console.log('Tentando acessar cole√ß√£o de contatos...');
                        const snapshot = await getDocs(collection(db, "contatos"));
                        console.log('Sucesso! Total de contatos:', snapshot.size);
                        
                        snapshot.forEach(doc => {
                            console.log('Contato:', doc.id, doc.data());
                        });
                        
                        alert(`Conex√£o OK! ${snapshot.size} contatos encontrados.`);
                    } catch (error) {
                        console.error('Erro ao acessar Firestore:', error);
                        alert('Erro: ' + error.message);
                    }
                };

                // Hide loading when everything is ready
                hideLoading();
                window.initialized = true;
                console.log('%c‚úÖ SISTEMA CARREGADO COM SUCESSO!', 'color: #10B981; font-size: 16px; font-weight: bold;');
                console.log('Para importar os 18 clientes iniciais, clique em "Importar Clientes" na se√ß√£o Contatos');
            
            } catch (error) {
                console.error('Erro cr√≠tico ao inicializar o sistema:', error);
                hideLoading();
                alert('Erro ao inicializar o sistema: ' + error.message);
            }
        }

        // Start initialization after a small delay
        console.log('Aguardando 1 segundo antes de inicializar...');
        setTimeout(initializeApp, 1000);
        
        // Bot√£o de inicializa√ß√£o manual para debug
        window.manualInit = function() {
            console.log('Inicializa√ß√£o manual acionada');
            initializeApp();
        };
        
        // Adicionar bot√£o de debug no console
        console.log('Se o sistema n√£o carregar, execute: manualInit()');
        
        console.log('=== FIM DO SCRIPT PRINCIPAL ===');
        
        // Resumo de diagn√≥stico ap√≥s 5 segundos
        setTimeout(() => {
            console.log('%c=== RESUMO DE DIAGN√ìSTICO ===', 'color: #FF6B6B; font-size: 14px; font-weight: bold;');
            console.log('Firebase carregado:', window.db ? '‚úÖ' : '‚ùå');
            console.log('Firestore dispon√≠vel:', window.firestore ? '‚úÖ' : '‚ùå');
            console.log('Sistema inicializado:', window.initialized ? '‚úÖ' : '‚ùå');
            
            if (!window.db || !window.firestore) {
                console.log('%c‚ö†Ô∏è A√á√ÉO NECESS√ÅRIA:', 'color: #FF6B6B; font-weight: bold;');
                console.log('1. Verifique as regras do Firestore');
                console.log('2. Execute: manualInit()');
                console.log('3. Ou recarregue a p√°gina (F5)');
            } else {
                console.log('%c‚úÖ Tudo funcionando corretamente!', 'color: #10B981; font-weight: bold;');
                console.log('Dica: Use o bot√£o "Debug Firebase" no menu para testar a conex√£o');
            }
        }, 5000);
    </script>
<!-- Script de diagn√≥stico -->
<script>
        console.log('Script de diagn√≥stico carregado');
        
        // Teste de conectividade
        fetch('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js')
            .then(response => {
                console.log('‚úÖ CDN do Firebase acess√≠vel:', response.status);
            })
            .catch(error => {
                console.error('‚ùå Erro ao acessar CDN do Firebase:', error);
            });
        
        // Verificar estado do Firebase a cada 2 segundos
        let checkCount = 0;
        const checkFirebase = setInterval(() => {
            checkCount++;
            console.log(`Verifica√ß√£o ${checkCount}: window.db =`, window.db ? 'OK' : 'N√ÉO CARREGADO');
            console.log(`Verifica√ß√£o ${checkCount}: window.firestore =`, window.firestore ? 'OK' : 'N√ÉO CARREGADO');
            
            if (window.db && window.firestore) {
                console.log('‚úÖ Firebase est√° pronto!');
                clearInterval(checkFirebase);
                
                // Tentar inicializar automaticamente
                if (!window.initialized && window.manualInit) {
                    console.log('Iniciando sistema automaticamente...');
                    window.manualInit();
                }
            }
            
            if (checkCount > 10) {
                console.error('‚ùå Firebase n√£o carregou ap√≥s 20 segundos');
                clearInterval(checkFirebase);
                
                // Mostrar instru√ß√µes de debug
                console.log('=== INSTRU√á√ïES DE DEBUG ===');
                console.log('1. Verifique o console para erros');
                console.log('2. Verifique se h√° bloqueio de scripts');
                console.log('3. Execute manualInit() no console');
                console.log('4. Verifique as regras do Firestore no Firebase Console');
                console.log('5. Certifique-se de que as regras permitem leitura/escrita');
                console.log('');
                console.log('Regras sugeridas para teste (N√ÉO usar em produ√ß√£o):');
                console.log('‚ö†Ô∏è ATEN√á√ÉO: Estas regras s√£o APENAS para teste!');
                console.log('rules_version = "2";');
                console.log('service cloud.firestore {');
                console.log('  match /databases/{database}/documents {');
                console.log('    match /{document=**} {');
                console.log('      allow read, write: if true;');
                console.log('    }');
                console.log('  }');
                console.log('}');
                console.log('');
                console.log('üìç Para acessar o Firebase Console:');
                console.log('https://console.firebase.google.com/project/financeiro-share/firestore/rules');
            }
        }, 2000);
    </script>
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabase = createClient("https://nxtxlueqzujqnsuqxmry.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54dHhsdWVxenVqcW5zdXF4bXJ5Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MDg3ODg2NywiZXhwIjoyMDY2NDU0ODY3fQ.apS_VXJQJDdUdRVVny0k8RsFEL5IOYyZ-tsOfVcKvJU");

document.getElementById("funcionario-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const nome = document.getElementById("funcionario-nome").value;
  const cargo = document.getElementById("funcionario-cargo").value;
  const reembolsavel = document.getElementById("reembolsavel").checked;

  const { data: despesa, error } = await supabase
    .from("despesas")
    .insert([{ descricao: nome, valor: 0, tipo: 'saida', reembolsavel, pago: false }])
    .select()
    .single();

  if (error) {
    alert("Erro ao salvar.");
    return;
  }

  if (reembolsavel) {
    await supabase.from("contas_receber").insert([{
      data: new Date().toISOString().split('T')[0],
      descricao: `Reembolso - ${nome}`,
      valor: 0,
      status: "pendente",
      referencia_id: despesa.id
    }]);
  }

  alert("Salvo com sucesso!");
  e.target.reset();
});
</script>


<script type="module">
async function carregarContatos() {
    const tbody = document.getElementById('contatos-tbody');
    tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-gray-500 text-center">Carregando...</td></tr>';

    const { data, error } = await supabase.from('contatos').select('*').order('nome');
    if (error) {
        tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-red-500 text-center">Erro ao carregar contatos</td></tr>';
        return;
    }

    if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="p-8 text-gray-500 text-center">Nenhum contato encontrado</td></tr>';
        return;
    }

    tbody.innerHTML = '';
    data.forEach(contato => {
        const tr = document.createElement('tr');
        tr.className = 'border-b';
        tr.innerHTML = `
            <td class="p-3">{contato.nome}</td>
            <td class="p-3">{contato.tipo}</td>
            <td class="p-3">{contato.email}</td>
            <td class="p-3">
                <button onclick="excluirContato('{contato.id}')" class="text-red-500">üóëÔ∏è</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function excluirContato(id) {
    if (!confirm("Deseja remover este contato?")) return;
    const { error } = await supabase.from('contatos').delete().eq('id', id);
    if (error) {
        alert("Erro ao excluir");
        return;
    }
    carregarContatos();
}

carregarContatos();

document.getElementById("contato-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const nome = document.getElementById("contato-nome").value;
  const tipo = document.getElementById("contato-tipo").value;
  const email = document.getElementById("contato-email").value;

  const { error } = await supabase.from("contatos").insert([{
    nome,
    tipo,
    email
  }]);

  if (error) {
    alert("Erro ao salvar contato.");
    return;
  }

  alert("Contato salvo com sucesso!");
  e.target.reset();
  closeModal('contato');
  carregarContatos();
});
</script>
</body>
</html>
